{% extends "base.html" %}

{% block content %}

<div class="text-center mb-6">
<h2 class="text-3xl font-bold text-text-light">
Found <span class="text-secondary-neon">{{ coins|length }}</span> High Momentum Coins 
(Scanned <span class="text-accent-blue">{{ total_coins_scanned if total_coins_scanned is defined else 'N/A' }}</span> Total)
</h2>
</div>

{% if coins %}
<div class="overflow-x-auto rounded-lg shadow-2xl mb-8">
<table class="min-w-full divide-y divide-secondary-neon/50">
<thead class="bg-primary-dark/90 sticky top-0">
<tr>
<th scope="col" class="px-3 py-3 text-left text-xs font-medium text-text-light uppercase tracking-wider">
Coin
</th>
<th scope="col" class="px-3 py-3 text-left text-xs font-medium text-text-light uppercase tracking-wider">
Price
</th>
<th scope="col" class="px-3 py-3 text-left text-xs font-medium text-red-400 uppercase tracking-wider">
SL (0.5% Risk)
</th>
<th scope="col" class="px-3 py-3 text-left text-xs font-medium text-green-400 uppercase tracking-wider">
TP1 (1:3 R:R)
</th>
<th scope="col" class="px-3 py-3 text-left text-xs font-medium text-green-400 uppercase tracking-wider">
TP2 (1:5 R:R)
</th>
<th scope="col" class="px-3 py-3 text-left text-xs font-medium text-text-light uppercase tracking-wider hidden sm:table-cell">
Vol Spike Factor
</th>
<th scope="col" class="px-3 py-3 text-left text-xs font-medium text-text-light uppercase tracking-wider hidden md:table-cell">
Ratios (7/25 | 25/99)
</th>
<th scope="col" class="px-3 py-3 text-left text-xs font-medium text-text-light uppercase tracking-wider">
Scan Time
</th>
</tr>
</thead>

        <tbody class="divide-y divide-secondary-neon/30">
            {% for coin in coins %}
            <tr class="bg-primary-dark/80 hover:bg-primary-dark/95 transition duration-150">
                <td class="px-3 py-4 whitespace-nowrap text-sm font-semibold text-secondary-neon">
                    {{ coin.symbol }}
                </td>
                <td class="px-3 py-4 whitespace-nowrap text-sm text-text-light">
                    ${{ "%.4f"|format(coin.price) }}
                </td>
                <td class="px-3 py-4 whitespace-nowrap text-sm text-red-400 font-medium">
                    ${{ "%.4f"|format(coin.sl_price) }}
                </td>
                <td class="px-3 py-4 whitespace-nowrap text-sm text-green-400 font-medium">
                    ${{ "%.4f"|format(coin.tp1_price) }}
                </td>
                <td class="px-3 py-4 whitespace-nowrap text-sm text-green-400 font-medium">
                    ${{ "%.4f"|format(coin.tp2_price) }}
                </td>
                <td class="px-3 py-4 whitespace-nowrap text-sm text-accent-blue hidden sm:table-cell">
                    {{ "%.2f"|format(coin.spike_factor) }}x
                </td>
                <td class="px-3 py-4 whitespace-nowrap text-sm text-text-light hidden md:table-cell">
                    {{ "%.2f"|format(coin.ratios['7/25']) }} | {{ "%.2f"|format(coin.ratios['25/99']) }}
                </td>
                <td class="px-3 py-4 whitespace-nowrap text-xs text-text-light/70">
                    {{ coin.scan_time }}
                </td>
            </tr>
            <tr>
                <td colspan="8" class="p-0 border-none bg-primary-dark/70">
                    <div class="w-full h-80 lg:h-96">
                        <iframe 
                            src="https://s.tradingview.com/widgetembed/?frameElementId=tradingview_widget_{{ coin.symbol }}&symbol=BINANCE:{{ coin.symbol }}.P&interval=60&theme=dark&style=1&timezone=Etc%2FUTC&hide_side_toolbar=true&save_image=false&toolbar_bg=f1f3f6&details=true&studies=EMA%4025%2CEMA%4099%2CEMA%407&extended_name=BINANCE_FUTURES&withdateranges=2D"
                            style="width: 100%; height: 100%; margin: 0; padding: 0;"
                            frameborder="0" 
                            allowfullscreen
                            title="TradingView Chart for {{ coin.symbol }}"
                        ></iframe>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% else %}
<div class="text-center py-12 rounded-lg bg-primary-dark/80 border border-secondary-neon/50">
<p class="text-xl text-text-light mb-2">No coins currently meet the strict momentum criteria.</p>
<p class="text-md text-text-light/70 italic">Check back shortly, or adjust the EMA ratio parameters in scanner.py.</p>
</div>
{% endif %}

{% endblock %}